# ğŸ”§ Cloudflare Pages æ„å»ºä¿®å¤æŒ‡å—

## é—®é¢˜æè¿°

Cloudflare Pages æ„å»ºæ—¶å‡ºç°é”™è¯¯ï¼š
```
Error: Cannot find module '@rollup/rollup-linux-x64-gnu'
```

**åŸå› **ï¼š
- Cloudflare Pages ä½¿ç”¨ `npm clean-install`ï¼ˆå³ `npm ci`ï¼‰
- `npm ci` ä¸ä¼šå®‰è£…å¯é€‰ä¾èµ–
- Rollup çš„å¹³å°ç‰¹å®šä¾èµ–æ˜¯å¯é€‰ä¾èµ–ï¼Œéœ€è¦æ‰‹åŠ¨å®‰è£…

---

## âœ… è§£å†³æ–¹æ¡ˆï¼ˆå·²è‡ªåŠ¨ä¿®å¤ï¼‰

### è‡ªåŠ¨ä¿®å¤æ–¹æ¡ˆï¼ˆå·²åº”ç”¨ï¼‰

å·²æ·»åŠ  `prebuild` è„šæœ¬åˆ° `package.json`ï¼Œ**æ— éœ€ä¿®æ”¹ Cloudflare Pages è®¾ç½®**ï¼

**å·¥ä½œåŸç†**ï¼š
- å½“è¿è¡Œ `npm run build` æ—¶ï¼Œnpm ä¼šè‡ªåŠ¨å…ˆæ‰§è¡Œ `prebuild` è„šæœ¬
- `prebuild` è„šæœ¬ä¼šå®‰è£…æ‰€æœ‰å¯é€‰ä¾èµ–ï¼ˆåŒ…æ‹¬ Linux ç‰ˆæœ¬çš„ Rollupï¼‰
- ç„¶åè‡ªåŠ¨æ‰§è¡Œ `build` è„šæœ¬è¿›è¡Œæ„å»º

**ä½ ä¸éœ€è¦åšä»»ä½•æ“ä½œ**ï¼Œç›´æ¥ä½¿ç”¨é»˜è®¤çš„ `npm run build` å³å¯ï¼

### æ–¹æ¡ˆ2ï¼šæ‰‹åŠ¨ä½¿ç”¨ build:ciï¼ˆå¤‡é€‰ï¼‰

å¦‚æœè‡ªåŠ¨ä¿®å¤ä¸å·¥ä½œï¼Œå¯ä»¥åœ¨ Cloudflare Pages é¡¹ç›®è®¾ç½®ä¸­ä¿®æ”¹æ„å»ºå‘½ä»¤ï¼š

**æ„å»ºå‘½ä»¤**ï¼š
```
npm run build:ci
```

### æ–¹æ¡ˆ3ï¼šç›´æ¥åœ¨æ„å»ºå‘½ä»¤ä¸­å®‰è£…ï¼ˆå¤‡é€‰ï¼‰

å¦‚æœæ–¹æ¡ˆ2ä¸è¡Œï¼Œå¯ä»¥ç›´æ¥åœ¨ Cloudflare Pages è®¾ç½®ä¸­ä½¿ç”¨ï¼š

**æ„å»ºå‘½ä»¤**ï¼š
```
npm ci && npm install --include=optional --no-save && npm run build
```

---

## ğŸ“‹ é…ç½®æ­¥éª¤

### âœ… è‡ªåŠ¨ä¿®å¤ï¼ˆæ¨è - æ— éœ€æ“ä½œï¼‰

**å·²è‡ªåŠ¨é…ç½®**ï¼`prebuild` è„šæœ¬ä¼šåœ¨æ¯æ¬¡æ„å»ºå‰è‡ªåŠ¨è¿è¡Œã€‚

**ä½ åªéœ€è¦**ï¼š
1. æäº¤ä»£ç æ›´æ”¹
2. Cloudflare Pages ä¼šè‡ªåŠ¨é‡æ–°éƒ¨ç½²
3. æ„å»ºåº”è¯¥ä¼šæˆåŠŸ

### æ‰‹åŠ¨é…ç½®ï¼ˆå¦‚æœè‡ªåŠ¨ä¿®å¤ä¸å·¥ä½œï¼‰

å¦‚æœè‡ªåŠ¨ä¿®å¤ä¸å·¥ä½œï¼Œå¯ä»¥åœ¨ Cloudflare Pages Dashboard ä¸­æ‰‹åŠ¨é…ç½®ï¼š

1. **ç™»å½• Cloudflare Pages**
   - è®¿é—® https://dash.cloudflare.com
   - è¿›å…¥ä½ çš„é¡¹ç›®

2. **è¿›å…¥æ„å»ºè®¾ç½®**
   - ç‚¹å‡»é¡¹ç›® â†’ Settings â†’ Builds & deployments

3. **ä¿®æ”¹æ„å»ºå‘½ä»¤**ï¼ˆå¯é€‰ï¼‰
   - æ‰¾åˆ° "Build command" å­—æ®µ
   - å°† `npm run build` æ”¹ä¸º `npm run build:ci`
   - æˆ–ä½¿ç”¨ï¼š`npm ci && npm install --include=optional --no-save && npm run build`

4. **ä¿å­˜å¹¶é‡æ–°éƒ¨ç½²**
   - ç‚¹å‡» "Save"
   - è§¦å‘æ–°çš„éƒ¨ç½²

---

## ğŸ” éªŒè¯ä¿®å¤

éƒ¨ç½²åæ£€æŸ¥æ„å»ºæ—¥å¿—ï¼Œåº”è¯¥çœ‹åˆ°ï¼š

1. âœ… `npm ci` æˆåŠŸå®‰è£…ä¾èµ–
2. âœ… `npm install --include=optional` å®‰è£…å¯é€‰ä¾èµ–
3. âœ… æ„å»ºæˆåŠŸå®Œæˆ
4. âœ… æ²¡æœ‰ Rollup æ¨¡å—æ‰¾ä¸åˆ°çš„é”™è¯¯

---

## ğŸ“ æŠ€æœ¯è¯´æ˜

### ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªä¿®å¤ï¼Ÿ

1. **npm ci çš„é™åˆ¶**ï¼š
   - `npm ci` ä¸¥æ ¼æŒ‰ç…§ `package-lock.json` å®‰è£…
   - ä¸ä¼šå®‰è£…å¯é€‰ä¾èµ–ï¼ˆoptional dependenciesï¼‰
   - è¿™æ˜¯ä¸ºäº†ç¡®ä¿æ„å»ºçš„å¯é‡å¤æ€§

2. **Rollup çš„å¯é€‰ä¾èµ–**ï¼š
   - Rollup ä½¿ç”¨å¯é€‰ä¾èµ–æ¥æ”¯æŒä¸åŒå¹³å°
   - Windows: `@rollup/rollup-win32-x64-gnu`
   - Linux: `@rollup/rollup-linux-x64-gnu`
   - macOS: `@rollup/rollup-darwin-x64`

3. **è·¨å¹³å°é—®é¢˜**ï¼š
   - æœ¬åœ°å¼€å‘ï¼ˆWindowsï¼‰ç”Ÿæˆçš„ `package-lock.json`
   - Cloudflare Pages åœ¨ Linux ç¯å¢ƒæ„å»º
   - éœ€è¦ Linux ç‰ˆæœ¬çš„ Rollup

### package.json ä¸­çš„è„šæœ¬

å·²æ·»åŠ ä¸‰ä¸ªè„šæœ¬ï¼š

1. **`prebuild`**ï¼ˆå…³é”®ä¿®å¤ï¼‰ï¼š
   ```json
   "prebuild": "npm install --include=optional --no-save || true"
   ```
   - **åœ¨ `build` ä¹‹å‰è‡ªåŠ¨è¿è¡Œ**
   - å®‰è£…æ‰€æœ‰å¯é€‰ä¾èµ–ï¼ˆåŒ…æ‹¬ Linux ç‰ˆæœ¬çš„ Rollupï¼‰
   - `|| true` ç¡®ä¿å³ä½¿å¤±è´¥ä¹Ÿä¸å½±å“æ„å»º
   - **è¿™æ˜¯è‡ªåŠ¨ä¿®å¤çš„å…³é”®**

2. **`build:ci`**ï¼š
   ```json
   "build:ci": "npm install --include=optional --no-save && npm run build"
   ```
   - æ‰‹åŠ¨å®‰è£…å¯é€‰ä¾èµ–åæ„å»º
   - ä½œä¸ºå¤‡é€‰æ–¹æ¡ˆ

3. **`postinstall`**ï¼š
   ```json
   "postinstall": "npm install --include=optional --no-save || true"
   ```
   - åœ¨ `npm install` åè‡ªåŠ¨è¿è¡Œ
   - ç¡®ä¿å¯é€‰ä¾èµ–è¢«å®‰è£…
   - `|| true` ç¡®ä¿å³ä½¿å¤±è´¥ä¹Ÿä¸å½±å“æ„å»º

---

## ğŸ¯ æœ€ä½³å®è·µ

### 1. ä½¿ç”¨ build:ci è„šæœ¬

**ä¼˜ç‚¹**ï¼š
- âœ… æ¸…æ™°æ˜ç¡®
- âœ… æ˜“äºç»´æŠ¤
- âœ… å¯ä»¥åœ¨æœ¬åœ°æµ‹è¯•

**ä½¿ç”¨**ï¼š
- Cloudflare Pagesï¼šä½¿ç”¨ `npm run build:ci`
- æœ¬åœ°å¼€å‘ï¼šä½¿ç”¨ `npm run build`

### 2. å®šæœŸæ›´æ–°ä¾èµ–

```bash
# æ›´æ–°æ‰€æœ‰ä¾èµ–
npm update

# æ›´æ–°ç‰¹å®šä¾èµ–
npm update rollup vite

# é‡æ–°ç”Ÿæˆ lock æ–‡ä»¶
rm package-lock.json
npm install
```

### 3. åœ¨ CI/CD ä¸­æµ‹è¯•

ç¡®ä¿æ„å»ºåœ¨ä¸åŒå¹³å°éƒ½èƒ½æˆåŠŸï¼š
- Windowsï¼ˆæœ¬åœ°å¼€å‘ï¼‰
- Linuxï¼ˆCloudflare Pagesï¼‰
- macOSï¼ˆå¯é€‰ï¼‰

---

## ğŸš¨ å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨

### æ£€æŸ¥æ¸…å•

- [ ] Cloudflare Pages æ„å»ºå‘½ä»¤å·²æ›´æ–°ä¸º `npm run build:ci`
- [ ] `package.json` ä¸­åŒ…å« `build:ci` è„šæœ¬
- [ ] æ„å»ºæ—¥å¿—æ˜¾ç¤ºå¯é€‰ä¾èµ–è¢«å®‰è£…
- [ ] æ²¡æœ‰å…¶ä»–æ„å»ºé”™è¯¯

### å…¶ä»–è§£å†³æ–¹æ¡ˆ

1. **æ¸…é™¤æ„å»ºç¼“å­˜**ï¼š
   - åœ¨ Cloudflare Pages è®¾ç½®ä¸­æ¸…é™¤ç¼“å­˜
   - é‡æ–°éƒ¨ç½²

2. **åˆ é™¤ package-lock.json**ï¼š
   - è®© Cloudflare Pages åœ¨ Linux ç¯å¢ƒä¸‹é‡æ–°ç”Ÿæˆ
   - ä¼šåŒ…å«æ‰€æœ‰å¹³å°çš„å¯é€‰ä¾èµ–

3. **è”ç³»æ”¯æŒ**ï¼š
   - å¦‚æœé—®é¢˜æŒç»­ï¼Œè”ç³» Cloudflare æ”¯æŒ
   - æä¾›è¯¦ç»†çš„æ„å»ºæ—¥å¿—

---

## âœ… å½“å‰çŠ¶æ€

å·²æ›´æ–° `package.json`ï¼Œæ·»åŠ äº†ï¼š
- âœ… **`prebuild` è„šæœ¬**ï¼šåœ¨æ„å»ºå‰è‡ªåŠ¨å®‰è£…å¯é€‰ä¾èµ–ï¼ˆå…³é”®ä¿®å¤ï¼‰
- âœ… `build:ci` è„šæœ¬ï¼šæ‰‹åŠ¨å®‰è£…å¯é€‰ä¾èµ–åæ„å»ºï¼ˆå¤‡é€‰æ–¹æ¡ˆï¼‰
- âœ… `postinstall` è„šæœ¬ï¼šè‡ªåŠ¨å®‰è£…å¯é€‰ä¾èµ–

**ä¸‹ä¸€æ­¥**ï¼š
1. **æäº¤ä»£ç æ›´æ”¹**ï¼ˆ`prebuild` è„šæœ¬å·²è‡ªåŠ¨æ·»åŠ ï¼‰
2. Cloudflare Pages ä¼šè‡ªåŠ¨é‡æ–°éƒ¨ç½²
3. **æ— éœ€ä¿®æ”¹ Cloudflare Pages è®¾ç½®**ï¼Œä½¿ç”¨é»˜è®¤çš„ `npm run build` å³å¯
4. æ£€æŸ¥æ„å»ºæ—¥å¿—ç¡®è®¤æˆåŠŸ

**å¦‚æœè‡ªåŠ¨ä¿®å¤ä¸å·¥ä½œ**ï¼Œå¯ä»¥åœ¨ Cloudflare Pages è®¾ç½®ä¸­å°†æ„å»ºå‘½ä»¤æ”¹ä¸º `npm run build:ci`

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Vercel æ„å»ºä¿®å¤](./FIX_ROLLUP_ERROR.md)
- [å¤šå¹³å°éƒ¨ç½²æŒ‡å—](./MULTI_PLATFORM_DEPLOYMENT.md)
- [Cloudflare Pages å®˜æ–¹æ–‡æ¡£](https://developers.cloudflare.com/pages/)

---

**ä¿®å¤åï¼ŒCloudflare Pages åº”è¯¥èƒ½æˆåŠŸæ„å»ºäº†ï¼** ğŸ‰

